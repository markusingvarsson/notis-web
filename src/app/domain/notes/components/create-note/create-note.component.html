<!-- File: src/app/domain/notes/components/create-note/create-note.component.html -->
<div class="max-w-2xl mx-auto">
  <div
    class="bg-gradient-to-br from-[var(--tw-bg-light)] to-[var(--tw-bg)] rounded-2xl shadow-lg border border-[var(--tw-border-light)] overflow-hidden"
  >
    <app-page-header
      [title]="'Create a new note'"
      [subtitle]="'Record your thoughts with voice'"
    ></app-page-header>

    <!-- Content -->
    <div class="p-6 space-y-6">
      <!-- Save Mode Selection  -->
      @if (hasSpeechRecognition()) {
      <div>
        <span
          class="text-sm font-semibold text-[var(--tw-primary-dark)] mb-3 block"
        >
          Save as:
        </span>
        <div class="flex gap-6 justify-center">
          <label class="flex items-center space-x-3" for="save-text">
            <input
              id="save-text"
              type="radio"
              [checked]="saveMode() === 'text'"
              (change)="saveMode.set('text')"
              class="cursor-pointer"
            />
            <span class="text-sm text-[var(--tw-primary-dark)]">
              Transcribed Text
            </span>
          </label>
          <label class="flex items-center space-x-3" for="save-audio">
            <input
              id="save-audio"
              type="radio"
              [checked]="saveMode() === 'audio'"
              (change)="saveMode.set('audio')"
              class="cursor-pointer"
            />
            <span class="text-sm text-[var(--tw-primary-dark)]">
              Audio Recording
            </span>
          </label>
        </div>
      </div>
      } @if (currentView() === 'recording') {
      <!-- Record Button -->
      <div class="flex flex-col items-center space-y-6">
        <app-record-button
          [state]="recordingState()"
          [ariaLabelInput]="recordLabel()"
          (buttonClick)="toggleRecording()"
        ></app-record-button>
        <p class="text-center text-sm text-[var(--tw-border-dark)]">
          {{ recordLabel() }}
        </p>
      </div>
      } @if (currentView() === 'preview') {
      <!-- Note Name Input -->
      <div class="space-y-2">
        <label
          for="note-name"
          class="text-sm font-semibold text-[var(--tw-primary-dark)] block"
        >
          Note Name:
        </label>
        <input
          id="note-name"
          type="text"
          name="noteName"
          [(ngModel)]="noteName"
          class="w-full p-3 border border-[var(--tw-border-light)] rounded-lg bg-[var(--tw-bg-light)] text-[var(--tw-primary-dark)] focus:ring-2 focus:ring-[var(--tw-primary)] focus:border-transparent transition-shadow duration-150 ease-in-out"
          placeholder="Enter a name for your note (e.g., Meeting Summary)"
        />
      </div>
      }
      <!-- Preview Area -->
      @if (audioBlob() || transcriptText()) {
      <div
        class="bg-[var(--tw-bg)] rounded-xl p-4 border border-[var(--tw-border-light)]"
      >
        @if (saveMode() === 'audio' && audioBlob()) {
        <div class="flex items-center gap-3">
          <audio
            #audioElement
            [src]="audioSrc()"
            controls
            preload="auto"
            class="w-full"
          ></audio>
        </div>
        } @if (saveMode() === 'text' && transcriptText()) {
        <div>
          <span class="text-xs text-[var(--tw-border-dark)] mb-2 block">
            Transcription:
          </span>
          <p
            class="text-sm bg-[var(--tw-bg-light)] p-3 rounded-lg border border-[var(--tw-border-light)] min-h-[60px] text-[var(--tw-primary-dark)]"
          >
            {{ transcriptText() || "Transcribing..." }}
          </p>
        </div>
        }
      </div>
      }

      <!-- Action Buttons -->
      @if (audioBlob() || transcriptText()) {
      <div
        class="flex gap-3 justify-end pt-4 border-t border-[var(--tw-border-light)]"
      >
        <button
          (click)="clearRecording()"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-[var(--tw-border)] text-sm font-medium text-[var(--tw-primary-dark)] hover:bg-[var(--tw-bg-light)] transition-colors duration-150 ease-in-out"
        >
          Clear
        </button>
        <button
          (click)="handleSave()"
          class="inline-flex items-center gap-2 px-4 py-2 bg-[var(--tw-primary)] hover:bg-[var(--tw-primary-light)] text-white rounded-lg text-sm font-medium transition-colors duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"
        >
          ðŸ’¾ Save Note
        </button>
      </div>
      }
    </div>
  </div>
</div>
