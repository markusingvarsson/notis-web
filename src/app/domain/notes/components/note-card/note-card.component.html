<div
  (click)="onCardClick()"
  (keydown.enter)="onCardClick()"
  (keydown.space)="onCardClick()"
  tabindex="0"
  role="button"
  class="bg-gradient-to-br from-white/90 to-gray-50/80 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-gray-200 cursor-pointer group focus:outline-none focus:ring-2 focus:ring-[var(--tw-primary)] transition-all hover:shadow-md"
>
  <div class="flex items-start justify-between mb-4">
    <h3 class="text-lg font-semibold text-gray-900 line-clamp-2">
      {{ note().title }}
    </h3>

    <div class="flex items-center gap-1">
      <div class="relative group/menu">
        <button
          (click)="toggleMenu($event)"
          class="p-1 rounded-lg hover:bg-gray-100 transition-colors text-gray-500 hover:text-gray-700"
          aria-label="More options"
        >
          <app-more-vertical-icon />
        </button>

        @if (showMenu()) {
        <div
          class="absolute right-0 top-8 bg-white rounded-lg shadow-lg border border-gray-200 p-1 z-10"
        >
          <button
            (click)="onShare($event)"
            class="flex items-center gap-2 w-full px-3 py-2 text-left hover:bg-gray-50 rounded-md transition-colors text-sm"
          >
            <app-share-icon />
            Share
          </button>
          <button
            (click)="onDelete($event)"
            class="flex items-center gap-2 w-full px-3 py-2 text-left hover:bg-red-50 text-red-600 rounded-md transition-colors text-sm"
          >
            <app-trash-icon />
            Delete
          </button>
        </div>
        }
      </div>
    </div>
  </div>

  <p class="text-gray-600 text-sm line-clamp-3 mb-4 leading-relaxed">
    {{ preview() }}
  </p>

  @if (hasAudio()) {
  <div
    class="flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg border border-gray-100"
  >
    <button
      (click)="onPlayAudio($event)"
      class="flex items-center justify-center w-8 h-8 bg-[var(--tw-primary)] text-white rounded-full hover:bg-[var(--tw-primary-dark)] transition-colors shadow-sm"
      aria-label="Play audio"
    >
      @if (isPlaying()) {
      <app-pause-icon [size]="'3'" />
      } @else {
      <app-play-icon [size]="'3'" />
      }
    </button>
    <div class="flex items-center gap-2">
      <div class="flex items-center gap-1 text-gray-600">
        <app-microphone-icon color="black" [size]="16" />
        <span class="text-xs font-medium">Audio</span>
      </div>
      @if (formatAudioDuration()) {
      <span class="text-xs text-gray-500">{{ formatAudioDuration() }}</span>
      }
    </div>
  </div>

  <!-- Hidden audio element for playback -->
  <audio
    #audio
    [src]="audioSrc()"
    (ended)="onAudioEnded()"
    (play)="onAudioPlay()"
    (pause)="onAudioPause()"
    preload="metadata"
  ></audio>
  }

  @if (tags().length > 0) {
  <div class="flex items-center gap-1 mb-2">
    <app-tag-icon />
    <div class="flex gap-1 flex-wrap">
      @for (tag of tags().slice(0, 3); track tag) {
      <span class="px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full text-xs whitespace-nowrap">
        #{{ tag }}
      </span>
      } @if (tags().length > 3) {
      <span class="text-xs text-gray-500">+{{ tags().length - 3 }}</span>
      }
    </div>
  </div>
  }

  <div class="flex items-center gap-2 text-xs text-gray-500">
    <app-calendar-icon />
    <span>{{ timeAgo() }}</span>
  </div>
</div>
